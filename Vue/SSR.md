# 服务端渲染基础

现在前端框架的缺点：

1. 首屏加载时间长
2. 不利于 SEO

所以有解决方案

- 通过服务端渲染首屏直出，解决首屏渲染慢以及不利于 SEO 问题 通过客户端渲染接管页面内容交互得到更好的用户体验
- 这种方式我们通常称之为现代化的服务端渲染，也叫同构渲染，所谓的同构指的就是服务端构建渲染 + 客户端构建渲染。同理，这种方式构建的应用称之为服务端渲染应用或者是同构应用。

## 什么是渲染

我们这里所说的渲染指的是**把(数据** **+** **模板)拼接到一起**的这个事儿。

我们这里要关注的并不是如何渲染，而是在哪里渲染的问题?

## 传统的服务端渲染

最早期，Web 页面渲染都是在服务端完成的，即服务端运行过程中将所需的数据结合页面模板渲染为 HTML，响应给客户端浏览器。所以浏览器呈现出来的是直接包含内容的页面。

这种模式存在很多明显的不足：

- 应用的前后端部分完全耦合在一起，在前后端协同开发方面会有非常大的阻力; 
- 前端没有足够的发挥空间，无法充分利用现在前端生态下的一些更优秀的方案; 
- 由于内容都是在服务端动态生成的，所以服务端的压力较大;

- 相比目前流行的 SPA 应用来说，用户体验一般;

## 客户端渲染

传统的服务端渲染有很多问题，但是这些问题随着客户端 Ajax 技术的普及得到了有效的解决，Ajax 技 术可以使得客户端动态获取数据变为可能，也就是说原本服务端渲染这件事儿也可以拿到客户端做了。

上面讲了客户端渲染的问题，所以现在要讲讲同构渲染了

## 同构渲染

解决得了首屏的问题，但是又有新的问题

- 开发条件所限。浏览器特定的代码，只能在某些生命周期钩子函数 (lifecycle hook) 中使用;
- 一些外部扩展库 (external library) 可能需要特殊处理，才能在服务器渲染应用程序中运行。 
- 代码需要对环境进行判断，不同的环境执行不同的代码
- 涉及构建设置和部署的更多要求。与可以部署在任何静态文件服务器上的完全静态单页面应用程序 (SPA) 不同，服务器渲染应用程序，需要处于 Node.js server 运行环境（其他环境的暂时不支持）。

服务端负载会更大，如果在高流量的环境下需要准备相应的服务器负载和服务端渲染优化

有以上问题就需要好好思考

- 首屏渲染速度是否真的很重要
- 是否真的需要 SEO

# Nuxt

Nuxt.js 是一个基于 Vue.js 的服务端渲染应用框架，它可以帮我们轻松的实现同构应用。 通过对客户端/服务端基础架构的抽象组织，Nuxt.js 主要关注的是应用的 **UI** **渲染**。

登录信息需要持久化，以前只在客户端的时候还比较简单，现在服务端渲染的时候也需要用户信息，这个比较麻烦，使用第三方包 js-cookie 放到 cookie 里就行了，只在客户端里使用，这样刷新页面的时候，请求会带上 cookie，服务端渲染的时候就可以拿到用户信息了

在使用 Vuex 的时候，actions 里定义 nuxtServerInit 函数，只会在服务端运行，它可以在这拿到用户信息，然后 commit mutation 保存信息到 Vuex 容器中

在服务端的时候 process.server 为 true，在客户端的时候 process.client 为 true