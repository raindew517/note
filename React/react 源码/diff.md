- 对比 ui 变化需要对比 dom 结构
- 已知的通用的树结构 diff 算法复杂度太高 O(n^3)
- React 实现了启发式的 diff 算法，复杂度只有 O(n)

## diff 算法的假设前提

1. 类型不同的元素将生成不同的树形结构
2. 开发者可以通过定制 “key” 这一属性，来指明某个确定的元素

## diff 算法的策略

- 不同类型的元素 -  直接替换
- 同一类型的 DOM 元素 - 改变属性
- 同一类型的自定义组件元素 - 更换属性
- 递归比较子树 - 自上向下比较，并会利用 key 属性



得出

1. 避免替换外层组件，子组件即使相同也会直接被干掉
2. 使用 key



diff 所有的更新操作不是直接就生效的，而是作为操作存入了更新队列，React 会批量处理这些更新操作，避免频繁操作 DOM，这就是 patch

update 操作会被归类到五中操作中

- INSERT_MARKUP 插入新的节点
- MOVE_EXISTING 移动现有节点
- SET_MARKUP 更新现有节点属性
- TEXT_CONTENT 更新文本
- REMOVE_NODE 移除节点